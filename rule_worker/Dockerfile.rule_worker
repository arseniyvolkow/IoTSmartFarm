FROM python:3.11-slim

WORKDIR /app

# 1. Fix the path to requirements.txt
# Since context is '.', you must specify the folder
COPY rule_worker/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 2. Copy the entire project
# This puts 'rule_worker', 'common', etc., into /app
COPY . .

# 3. Run as a module
# This ensures absolute imports like 'from rule_worker.worker' work
CMD ["python", "-m", "rule_worker"]